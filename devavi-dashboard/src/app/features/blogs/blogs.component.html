<div class="blogs-container">
    <div class="toolbar">
        <mat-form-field appearance="outline">
            <mat-label>Search</mat-label>
            <input matInput [value]="search()" (input)="search.set($any($event.target).value)"
                placeholder="Search blogs..." />
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select [value]="statusFilter()" (selectionChange)="statusFilter.set($any($event.value))">
                <mat-option value="all">All</mat-option>
                <mat-option value="draft">Draft</mat-option>
                <mat-option value="published">Published</mat-option>
                <mat-option value="archived">Archived</mat-option>
            </mat-select>
        </mat-form-field>

        <button class='exportButton' mat-raised-button color="primary" (click)="exportCSV()">
            <mat-icon>file_download</mat-icon>
            Export CSV
        </button>

    </div>




    <table mat-table [dataSource]="filteredBlogs()" class="mat-elevation-z2" matSort [matSortActive]="sortColumn()"
        [matSortDirection]="sortDirection()" [trackBy]="trackById">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="sort('title')">Title</th>
            <td mat-cell *matCellDef="let blog">
                <h3 class="blog-title">
                    <a [routerLink]="['/viewBlog', blog._id]">{{ blog.title }}</a>
                </h3>
            </td>
        </ng-container>

        <!-- Author -->
        <ng-container matColumnDef="author">
            <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="sort('author_id')">Author</th>
            <td mat-cell *matCellDef="let blog">{{ blog.author_id }}</td>
        </ng-container>

        <!-- Read Time -->
        <ng-container matColumnDef="readTime">
            <th mat-header-cell *matHeaderCellDef>Read Time</th>
            <td mat-cell *matCellDef="let blog">{{ blog.readTime }} min</td>
        </ng-container>

        <!-- Status -->
        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let blog">
                <mat-chip [color]="blog.status === 'published' ? 'primary' : 'warn'" selected>
                    {{ blog.status }}
                </mat-chip>
            </td>
        </ng-container>

        <!-- Published -->
        <ng-container matColumnDef="published">
            <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="sort('published_at')">
                Published At
            </th>
            <td mat-cell *matCellDef="let blog">{{ blog.published_at | date: 'medium' }}</td>
        </ng-container>

        <!-- Actions -->
        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let blog">
                <button mat-icon-button color="primary" [routerLink]="['/viewBlog', blog._id]" aria-label="View">
                    <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="accent" *ngIf="blog.author_id===currentUserId || userRole=='admin'"
                    [routerLink]="['/editBlog', blog._id]" aria-label="Edit">
                    <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" *ngIf="blog.author_id===currentUserId || userRole=='admin'"
                    (click)="deleteBlog(blog._id)" aria-label="Delete">
                    <mat-icon>delete</mat-icon>
                </button>
            </td>
        </ng-container>

        <!-- Header Row -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

        <!-- Row with TrackBy -->
        <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackById"></tr>
    </table>

    <div class="paginator">
        <button mat-stroked-button (click)="changePage(-1)" [disabled]="currentPage() === 1">
            Prev
        </button>
        <span>Page {{ currentPage() }} of {{ totalPages() }}</span>
        <button mat-stroked-button (click)="changePage(1)" [disabled]="currentPage() === totalPages()">
            Next
        </button>
    </div>
</div>